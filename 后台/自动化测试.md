# TDD
**测试驱动开发 Test-Driven Development**  
![cycle](https://upload.wikimedia.org/wikipedia/commons/0/0b/TDD_Global_Lifecycle.png)

### Test-driven development cycle
1. 新增一个测试，在开发新功能之前都应该从编写测试开始
2. 运行所有的测试，新编写的测试应该要失败，因为还没有实现的代码
3. 编写实现代码，编写一些可以使测试通过的代码，这个阶段的任务就是使编写的代码通过测试，所以可能会使用一些奇怪的方法
4. 运行测试，使得所有代码都通过测试，确保新代码符合测试要求
5. 重构代码，提高可读性和可维护性

### Given-When-Then
Given-When-Then表达方式可以称之为一个公式或者一个模板，这种方式旨在指导程序员为“用户故事”编写测试用例变得方便。
- Given 一个上下文，指定测试预设
- When 进行一系列操作，即所要执行的操作
- Then 得到一系列可观察的后果，即需要检测的断言

## 工具
### JUnit
> 单元测试框架  

JUnit4常见方法
注解 | 作用
---|---
@Test | 定义一个要测试的方法
@Test(expected = xxxException.class) | 若测试时方法抛出xxxException异常则测试成功
@Test(timeout = 毫秒) | 超出该时间则测试失败
@Before | 在每一个测试之前，都会被执行的方法，常用来做一些测试环境的初始化
@After | 与@Before进行对应，在每一个测试结束后，都会被执行的方法，常用来做一些清理工作
@BeforeClass | 在所有测试开始之前执行
@AfterClass | 在所有测试结束后执行
@Ignore | 表明测试是被忽略的
assertxxx | 断言

### Mocktio
Mock 方法是单元测试中常见的一种技术，它的主要作用是模拟一些在应用中不容易构造或者比较复杂的对象，从而把测试与测试边界以外的对象隔离开。  
- mock: 整个对象mock
- spy: 对象的方法mock
- verify: 验证

mock和spy可以使用注解进行改写，要在@Before加上MockitoAnnotations.initMocks(this)  
对被测类中@Autowired的对象，用@Mocks标注；对被测类自己，用@InjectMocks标注  
被@Mock标注的对象会自动注入到被@InjectMocks标注的对象中  

### H2, Flyway
#### H2
内嵌式内存数据库
- 纯Java编写，不受平台的限制；
- 只有一个jar文件，适合作为嵌入式数据库使用；
- 功能完整，支持标准SQL和JDBC；

#### Flyway
数据库版本控制工具，能自动建表
