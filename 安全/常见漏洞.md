# 常见漏洞

## 跨站脚本XSS

### 简介

Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。

为了和 CSS 区分，这里把攻击的第一个字母改成了 X，于是叫做 XSS。

XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。

而由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。

在部分情况下，由于输入的限制，注入的恶意脚本比较短。但可以通过引入外部的脚本，并由浏览器执行，来完成比较复杂的攻击策略。

### 分类 

- 反射型xss
  反射型xss一般出现在URL参数中及网站搜索栏中，由于需要点击包含恶意代码的URL才可以触发，并且只能触发一次，所以也被称为“非持久性xss”。
- 存储型xss
  存储型xss一出现在网站留言板，评论处，个人资料处，等需要用户可以对网站写入数据的地方。比如一个论坛评论处由于对用户输入过滤不严格，导致攻击者在写入一段窃取cookie的恶意JavaScript代码到评论处，这段恶意代码会写入数据库，当其他用户浏览这个写入代码的页面时，网站从数据库中读取恶意代码显示到网页中被浏览器执行，导致用户cookie被窃取，攻击者无需受害者密码即可登录账户。所以也被称作“持久性xss”。持久性xss比反射型xss危害要大的多。
- dom型xss
DOM xss是基于dom文档对象模型，前端脚本通过dom动态修改页面，由于不与服务端进行交互，而且代码是可见的，从前端获取dom中的数据在本地执行。
常见的可以操纵dom的对象：URL，localtion,referrer等

### 防御

1. 输入：**不要相信任何输入的内容**

   对输入的内容做转义，过滤，白名单等

2. 输出

   1. 参与运算的动态变量，最好转化为对应类型后再运算。如number型
   2. 如果是字符串操作，保证字符串被引号包裹
   3. 不能使用eval ，new fuction，settimeout执行动态字符串，因为这个字符串很可能就是一个xss代码，如果无法避免，那么也要转义之后再参与运算
   4. 输出到页面上的数据必须使用相应方法转义

https://alf.nu/alert1

## URL重定向未验证漏洞

URL跳转漏洞仅是重定向到另一个网址，如：https://www.example.com/?go=https://www.google.com/，当我们访问这个url时，将从example.com跳转到google.com。通常来说，它们被归类到低影响的一类中，一般都是与钓鱼一起用

[Web安全学习心得之URL跳转（五）](https://www.imbajin.com/Web安全学习心得之URL跳转（五）/)

### 防御

1. 签名验证。如果跳转的url事先可以确定，可以对跳转链接后端进行签名验证或token验证以防篡改。

2. 白名单限制。如果跳转的url事先不确定，后端建立跳转过滤规则，保证跳转的url来自可信域。

3. 还有一点就是要设置网络边界，对内外网系统进行访问边界访问控制。当然，在建立过滤规则时，不能太过简单，应该考虑全面，防止绕过。

## 验证缺陷类型

未对关键参数做处理，如修改参数中的账号，黑客可根据此参数攻击已知的账户

会有越权行为

## sql注入

SQL注入是一种将SQL代码添加到输入参数中，传递到服务器解析并执行的一种攻击手法。

SQL注入攻击是输入参数未经过滤，然后直接拼接到SQL语句当中解析，执行达到预想之外的一种行为，称之为SQL注入攻击。

正常访问url：aaa.com/bbb.aspx?id=1，对应的sql：`SELECT * FROM table WHERE id='#{id}' -> SELECT * FROM teble WHERE id='1'`

注入：aaa.com/bbb.aspx?id=1' and 1=1;--，对应的sql：`SELECT * FROM table WHERE id='#{id}' -> SELECT * FROM teble WHERE id='1' and 1=1;--'`

### 防御

1. 严格检查输入变量的类型和格式
2. 过滤和转义特殊字符
3. sql预编译机制，变量采用占位符进行占位，不要拼接sql

工具sqlmap